<%= render "partial/header" %>

<%# Display notices and alerts using Bootstrap alerts %>
<% if notice.present? || alert.present? %>
  <div class="mt-3">
    <% if notice %>
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <%= notice %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    <% end %>
    <% if alert %>
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <%= alert %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    <% end %>
  </div>
<% end %>

<%# Card for item display %>
<div class="card m-3 shadow-sm" style="width: 22rem;">
  <%= image_tag @item.image.url, class: "card-img-top", style: "height: 250px; object-fit: cover;" %>
  <div class="card-body">
    <h5 class="card-title"><%= @item.name %></h5>
  </div>
</div>

<%# Progress bar and item name %>
<div class="mt-3">
  <p class="fw-bold">Progress</p>
  <div class="progress">
    <div
      id="progress-bar"
      class="progress-bar"
      role="progressbar"
      style="width: 0%;"
      aria-valuenow="0"
      aria-valuemin="0"
      aria-valuemax="100">
      0%
    </div>
  </div>
</div>

<%# Form for minimum tickets input %>
<div class="mt-4">
  <%= form_with url: lottery_index_path, local: true, class: "row g-3" do |f| %>
    <%= f.hidden_field :item_id, value: @item.id %>
    <div class="col-12">
      <%= f.label :minimum_tickets, "Minimum Tickets", class: "form-label" %>
      <%= f.number_field :minimum_tickets,
                         class: "form-control",
                         id: "minimum-tickets",
                         min: 0,
                         value: 0,
                         required: true %>
    </div>
    <div class="col-12">
      <%= f.submit "Submit", class: "btn btn-primary w-100" %>
    </div>
  <% end %>
</div>

<%# Serial numbers display %>
<div class="mt-4">
  <h4>Your Item Ticket Serial Numbers</h4>
  <ul class="list-group">
    <% @item_serial_numbers.each do |item_serial_number| %>
      <li class="list-group-item">
        <%= item_serial_number.serial_number %>
      </li>
    <% end %>
  </ul>
</div>

<!-- JavaScript -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const numberField = document.getElementById("minimum-tickets");
        const progressBar = document.getElementById("progress-bar");

        numberField.addEventListener("input", () => {
            const value = parseInt(numberField.value) || 0; // Fallback to 0 if input is empty or invalid
            const progress = Math.min(value, 100); // Limit progress to 100%

            // Update the progress bar
            progressBar.style.width = `${progress}%`;
            progressBar.setAttribute("aria-valuenow", progress);
            progressBar.textContent = `${progress}%`;
        });
    });
</script>

<%= render "partial/footer" %>